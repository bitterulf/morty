<html>
    <head>
        <script src="//unpkg.com/mithril/mithril.js"></script>
        <script src="/primus/primus.js"></script>
        <script>
            let state;

            const primus = Primus.connect();

            var Hello = {
                view: function() {
                    if (!state) {
                        return m('div', 'loading');
                    }

                    return m('main', [
                        m('h1', {}, 'morty'),
                        m('button',  { onclick: function() {
                            primus.write({type: 'zapp', payload: {}});
                        } }, 'portal gun'),
                        m('div', {}, state.users.map(function(user) {
                            return m('div', user.id + (user.money ? ' money: ' + user.money : '') );
                        })),
                        m('div', {}, state.portals.map(function(portal) {
                            return m('div', 'portal from '+portal.owner);
                        }))
                    ])
                }
            }

            primus.on('data', function message(data) {
                state = data;
                m.redraw();
                console.log('Received a new message from the server', data);
            });
        </script>
        <title>morty</title>
    </head>
    <body>
        <div id='app'></div>
        <script>
            m.mount(document.querySelector('#app'), Hello)
        </script>
    </body>
</html>
